## 前端性能优化

### 1.性能优化的指标和工具

#### 1.1性能的指标有哪些

这里把它分成两类, 加载和响应,其中加载模块有

+ 理解加载瀑布图
+ 基于HAR存储与重建性能信息
+ 速度指数(Speed Index)页面所有内容花的时间
+ 重要的测量指标
  + Speed Index
  + TTFB 衡量你请求发送出去到回来一共用了多长时间
  + 页面加载时间
  + 首次渲染

**瀑布图分析**

一个请求需要先经过浏览器排队才能发送出去, 然后对于域名有一个DNS 解析的时间, 然后是浏览器和服务器建立连接的TCP请求的时间,对于https的请求,为了保证安全使用了SSL证书,就要进行SSL验证,这个过程叫做SSL协商,接下来才是将请求发送出去, 而发送出去再到真正的回来,中间还有一个过程有一个参数就是`TTFB`, 表示你从发出到真正的回来用了多长时间, 最后就是下载资源时间

chorme 中蓝线是DOM 加载完的时间, 红线是资源加载完的时间

**Chrome 提供的工具Lighthouse 性能检测报告**

First Contentful Paint 表示页面真正出现内容的时间

Speed Index  速度指数, 4s为分界线

#### 1.2 RAIL 测量模型

RAIL 评估标准

+ 响应: 处理时间应在 50ms
+ 动画: 10ms 每一帧
+ 空闲: 尽可能增加空闲时间
+ 加载: 在5s内完成加载并可以交互



性能测试工具

+ Chrome DevTools 开发调试,性能评测
+ Lighthouse 网站整体质量评估
+ WebPageTest 多测试地点, 全面性能报告

#### 1.3 WebPageTest 使用 来评估网站性能

www.webpagetext.org 网站

解析WbePagTest报告

+ waterfall chart 请求瀑布图
+ first view 首次访问
+ repeat view 二次访问

如何本地部署WebPageTest工具

#### 1.4 LightHouse 分析性能

使用安装方式

+ 本地 npm 安装 Lighthouse
+ Chrome DevTools 中使用
+ 通过 chrome web store 安装插件

**LightHouse 生成报告分析**

....

小知识点: 如何判断某个资源是否是必须第一时间加载的文件

#### 1.5 使用Chrome DevTools 分析性能

**查看文件大小以及优化**

请求资源是可以压缩的, 从 netWork中可以看到资源大小上有两个参数, 这个的意思是资源的大小和请求过来的资源的大小,两者可以不一样, 比如我们将资源按指定规则压缩,然后再请求回来后在进行解压

**DOM性能指标**

通过Performance选项卡 查看主线程中的耗时

#### 1.6 常见性能API

+ 关键时间节点(Navigation Timing, Resource Timing)
+ 网络状态(Network APIs)
+ 客户端服务端协商(HTTP Client Hints) & 网页显示状态(UI APIs)

**监听当前界面的显示与隐藏**

监听 `visiblitychange`时间, 注意不同浏览器的时间名称是不一样的

```js
let vEvent = 'visiblitychange'
if (document.webkitHidden != undefined) {
    // webkit 事件名称
    vEvent = 'webkitvisiblitychange'
}
function visiblityChanged() {
    if(document.hidden || document.webkitHidden) {
        console.log("Web page is hidden")
    } else {
        console.log("web page is visibile")
    }
}
document.addEventListener(vEvent, visiblityChanged, false)
```

**判断当前网络状态**

```js
let connection = navigator.connection || navigator.mozConnection || navigator.webkitConnection
let type = connection.effectiveType
function updateConectionStatus() {
	console.log(connection.effectiveType)
}
connection.addEventListener('change', updateConectionStatus, false)
```

#### 1.7 小结

**瀑布图是什么**

通过查看Chorme的瀑布图可以看到你的每一个请求,从排队,DNS解析,SSL认证,TTFB发送请求到下载化的时间,并且你可以看到文件的大小,文件大小分为实际大小和请求过来的文件大小(可通过压缩优化)

**常见的性能指标有哪些**

首屏加载时间,整个界面加载完毕的速度指数 



